// This program connects to Lamp Stack Server. Three variable names are used 

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.util.Scanner;
import java.sql.PreparedStatement;
import java.text.ParseException;
import java.text.SimpleDateFormat;

public class Sprint {
	// Enter database name, username, and password
	// private static String DBname = "mydb";
	// private static String DBusername = "root";
	// private static String DBpassword = "CECS323cecs";
	
	// Connection string
    //private static String dbURL1 = "jdbc:mysql://localhost:3306/" + DBname + "?user=" + DBusername + "&password=" + DBpassword;
	
	//private static String dbURL1 = "jdbc:mysql://192.168.189.134:3306/empDB?user=cecs323b&password=cecs323";
	
	//These connect to school server
	private static String dbURL1 = "jdbc:mysql://cecs-db01.coe.csulb.edu:3306/cecs323h10?user=cecs323h10&password=ae9aed";
	//private static String dbURL1 = "jdbc:mysql://cecs-db01.coe.csulb.edu:3306/cecs323h15?user=cecs323h15&password=ii3beu";
	
	//private static String dbURL1 = "jdbc:mysql://localhost:3306/mydb?user=root&password=CECS323cecs";
	private static Connection conn1 = null;
	private static Statement stmnt = null;

	public static void main(String[] args) {
		CreateConnection();
		SelectOption();
		shutdown();
	}

	// Create connection
	private static void CreateConnection() {
		try {
			conn1 = DriverManager.getConnection(dbURL1);
		} catch (SQLException ex) {
			ex.printStackTrace();
		}
	}

	public static void SelectOption() {
		Scanner input = new Scanner(System.in);
			// menu
			System.out.println("\n\nManage Records Menu");
			System.out.println(
					"______________________________________________________________________________________________________");
			System.out.println("1. CRUD Stakeholder");
			System.out.println("2. CRUD Scrum Team Members");
			System.out.println("3. CRUD UserStory");
			System.out.println("4. Create Sprint");
			System.out.println("5. Add user stories to the backlog");
			System.out.println("6. Features to operate user stories of backlog");
            System.out.println("7. List developer and Sprints");
            System.out.println("8. List developer that is part of a Sprint");
            System.out.println("9. Quit");
			System.out.println("Enter Your Choice: ");
	        int options = input.nextInt();
			System.out.print("\n");

			switch (options) {
			case 1:
				//CRUD stakeholders
				System.out.println("1. Create stakeholder");
				System.out.println("2. Read stakeholder");
				System.out.println("3. Update stakeholder");
				System.out.println("4. Delete stakeholder");
				int opt1 = input.nextInt();
				if(opt1 == 1){
				try{
					System.out.println("Creating a new stakeholder... ");
					System.out.println("Enter stakeholder name: ");
					String StakeholderName = input.next();
					System.out.println("Enter stakholder role: ");
					String StakeholderRole = input.next();
					System.out.println("Enter scrum team ID: ");
					String ScrumTeamID = input.next();
					String insert = "INSERT INTO Stakeholder(StakeholderName, StakeholderRole, ScrumTeamID)"   		
							+ "\nVALUES (?, ?, ?)";
					PreparedStatement prep = (PreparedStatement) ((Connection) conn1).prepareStatement(insert);
					prep.setString(1, StakeholderName);
					prep.setString(2, StakeholderRole);
					prep.setString(3, ScrumTeamID);
					//executes prepare statement
					prep.execute();
					}
				    catch (SQLException ex) {
				        ex.printStackTrace();
				    }
				}
				else if(opt1 == 2){
					 try{
				            stmnt = conn1.createStatement();
				           //establishes results of the table
				            ResultSet results = stmnt.executeQuery("select * from Stakeholders");
				            ResultSetMetaData rsmd = results.getMetaData();
				            int numberCols = rsmd.getColumnCount();
				            for (int i=1; i<=numberCols; i++) {
				                //printColumnNames
				                System.out.print(rsmd.getColumnLabel(i)+"\t\t");
				            }
				            System.out.println("\n------------------------------------------------------------------------");
				//prints the table along with the recipe
				            while(results.next())
				            {
				            	String StakeholderName = results.getString(1); 
				            	String StakeholderRole = results.getString(2);
				                String ScrumTeamID = results.getString(3);
				                System.out.println(StakeholderName + "\t\t" + StakeholderRole+ "\t\t" + ScrumTeamID);
				            }
				            results.close();
				            stmnt.close();
				        }
				        catch (SQLException ex) {
				            ex.printStackTrace();
				        }
				}
				else if(opt1 == 3){
					
				}
				else if(opt1 == 4){
					
				}
				else{
					System.out.println("Try again");
				}
				break;
				
			case 2:
				//CRUD Sprint team members
				System.out.println("1. Create sprint team member");
				System.out.println("2. Read sprint team member");
				System.out.println("3. Update sprint team member");
				System.out.println("4. Delete sprint team member");
				int opt2 = input.nextInt();
				if(opt2 == 1){
				try{
					System.out.println("Creating a sprint team member... ");
					System.out.println("Entera sprint team id: ");
					int idSprintTeam = input.nextInt();
					System.out.println("Enter team member name: ");
					String SprintTeamMemberName = input.next();
					System.out.println("Enter the scrum team: ");
					String ScrumTeam = input.next();
					System.out.println("Enter date: ");
					int idSprint = input.nextInt();
					String insert = "INSERT INTO SprintTeam(idSprintTeam, SprintTeamMemberName, ScrumTeam, idSprint)"   		
							+ "\nVALUES (?, ?, ?, ?)";
					PreparedStatement prep = (PreparedStatement) ((Connection) conn1).prepareStatement(insert);
					prep.setInt(1, idSprintTeam);
					prep.setString(2, SprintTeamMemberName);
					prep.setString(3, ScrumTeam);
					prep.setInt(4, idSprint);
					//executes prepare statement
					prep.execute();
					}
				    catch (SQLException ex) {
				        ex.printStackTrace();
				    }
				}
				else if(opt2 == 2){
					try{
			            stmnt = conn1.createStatement();
			           //establishes results of the table
			            ResultSet results = stmnt.executeQuery("select * from SprintTeam");
			            ResultSetMetaData rsmd = results.getMetaData();
			            int numberCols = rsmd.getColumnCount();
			            for (int i=1; i<=numberCols; i++) {
			                //printColumnNames
			                System.out.print(rsmd.getColumnLabel(i)+"\t\t");
			            }
			            System.out.println("\n------------------------------------------------------------------------");
			//prints the table along with the recipe
			            while(results.next())
			            {
			            	int SprintTeamID = results.getInt(1); 
			            	String SprintTeamMemberName = results.getString(2);
			                String ScrumTeamID = results.getString(3);
			                String idSprint = results.getString(4);
			                System.out.println(SprintTeamID + "\t\t" + SprintTeamMemberName + "\t\t" + ScrumTeamID + "\t\t" + idSprint);
			            }
			            results.close();
			            stmnt.close();
			        }
			        catch (SQLException ex) {
			            ex.printStackTrace();
			        }
				}
				else if(opt2 == 3){
					
				}
				else if(opt2 == 4){
					
				}
				else{
					
				}
				break;
			case 3:
				//CRUD UserStory
				System.out.println("1. Create UserStory");
				System.out.println("2. Read UserStory");
				System.out.println("3. Update UserStory");
				System.out.println("4. Delete UserStory");
				int opt4 = input.nextInt();
				if(opt4 == 1){
					try{
						System.out.println("Making UserStory... ");
						System.out.println("Enter Sprint id of the UserStory: ");
						int idSprint = input.nextInt();
						System.out.println("Enter UserStory title: ");
						String title = input.next();
						System.out.println("Enter UserStory status: ");
						String UserStoryStatus = input.next();
						String insert = "INSERT INTO UserStory(title, UserStoryStatus, idSprint)"   		
								+ "\nVALUES (?, ?, ?)";
						PreparedStatement prep = (PreparedStatement) ((Connection) conn1).prepareStatement(insert);
						prep.setString(1, title);
						prep.setString(2, UserStoryStatus);
						prep.setInt(3, idSprint);
						//executes prepare statement
						prep.execute();
						}
					    catch (SQLException ex) {
					        ex.printStackTrace();
					    }	
				}
				else if(opt4 == 2)	{
					 try{
				            stmnt = conn1.createStatement();
				           //establishes results of the table
				            ResultSet results = stmnt.executeQuery("select * from UserStory");
				            ResultSetMetaData rsmd = results.getMetaData();
				            int numberCols = rsmd.getColumnCount();
				            for (int i=1; i<=numberCols; i++) {
				                //printColumnNames
				                System.out.print(rsmd.getColumnLabel(i)+"\t\t");
				            }
				            System.out.println("\n------------------------------------------------------------------------");
				//prints the table along with the recipe
				            while(results.next())
				            {
				            	String title = results.getString(1); 
				            	String UserStoryStatus = results.getString(2);
				                int idSprint  = results.getInt(3);
				                System.out.println(title + "\t\t" + UserStoryStatus + "\t\t" + idSprint);
				            }
				            results.close();
				            stmnt.close();
				        }
				        catch (SQLException ex) {
				            ex.printStackTrace();
				        }
				}
				else if(opt4 == 3){
					
				}
				else if(opt4 == 4){
					
				}
				else{
					
				}
				break;
			case 4:
				//Create Sprint
					try{
						System.out.println("Making new Sprint... ");
						System.out.println("Enter sprint id: ");
						int idSprint = input.nextInt();
						System.out.println("Enter start date of sprint: ");
						String startDate = input.next();
						System.out.println("Enter end date of sprint: ");
						String endDate = input.next();
						System.out.println("Enter status of sprint(finished/started): ");
						String status = input.next();
						String insert = "INSERT INTO Sprint(idSprint, startDate, endDate, status)"   		
								+ "\nVALUES (?, ?, ?, ?)";
						PreparedStatement prep = (PreparedStatement) ((Connection) conn1).prepareStatement(insert);
						prep.setInt(1, idSprint);
						prep.setString(2, startDate);
						prep.setString(3, endDate);
						prep.setString(4, status);
						//executes prepare statement
						prep.execute();
						}
					    catch (SQLException ex) {
					        ex.printStackTrace();
					    }

			    break;
			case 5:
				//Add user stories to the backlog
		        break;
			case 6:
				//Features to operate user stories of backlog
				break;
			case 7:
				//List developer and Sprints
				break;
			case 8:
				//List developer that is part of a Sprint
				break;
			case 9:
				shutdown();
				break;
			}
		    System.out.println("Enter an option: ");
			options = input.nextInt();
		}      
			
	// Terminate connection at end
	private static void shutdown() {
		try {
			if (stmnt != null) {
				stmnt.close();
			}
			if (conn1 != null) {
				conn1 = DriverManager.getConnection(dbURL1 + "shutdown=true");
				conn1.close();
			}
		} catch (SQLException slqEx) {

		}
	}
}

